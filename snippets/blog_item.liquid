{% assign blog_comments = comments %}

<div class="article {% unless article.image %} no-image {% endunless %}">

  <div class="article__content_wrapper">

    <div class="flex">

      {% if article.metafields.custom.preview_image != blank %}
        {% assign article_image = article.metafields.custom.preview_image %}
        {% capture bgset %}
              {{ article_image | image_url: width: 220 }} 220w,
              {{ article_image | image_url: width: 440 }} 440w,
              {{ article_image | image_url: width: 880 }} 880w
        {% endcapture %}
      {% else %}
        {% if article.image %}
          {% assign article_image = article.image %}
          {% capture bgset %}
            {% render 'bgset', image: article.image %}
          {% endcapture %}
        {% endif %}
      {% endif %}
      {% if article_image %}
        <a href="{{ article.url }}" class="article__img_wrapper">
          <figure
            class="article__img lazyload no-js"
            data-bgset="{{ bgset }}"
            data-widths="[220,440,880]"
            data-sizes="auto"
            data-parent-fit="cover"></figure>
          <noscript>
            <figure class="article__img" style="background-image:url('{{ article_image | image_url: width: 600 }}')">
              <img
                class="no-js lazyload"
                src="{{ article_image | image_url: width: 600 }}"
                srcset="{{ article_image | image_url: width: 600 }} 1x, {{ article_image | image_url: width: 600 }} 2x"
                alt="{{ article_image.alt }}"
                width="345"
                height="200">
            </figure>
          </noscript>
        </a>
      {% endif %}

      <div class="article__content{% if centered %} text-center{% endif %}">
        {% render 'article-tag', article: article %}

        <h2 class="h3 article__title">
          <a href="{{ article.url }}">
            {{ article.title }}
          </a>
        </h2>
        {% include 'blog_meta' with blog_comments %}

        <div class="article__excerpt rte">
          <p>{{ article.excerpt_or_content | strip_html | truncatewords: 25 }}</p>
          {% if social %}
            <div>
              {% include 'page_share', article: article %}
            </div>
          {% endif %}
        </div>

      </div>

    </div>

  </div>

</div>